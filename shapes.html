<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shape Builder â€” Otherwind</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Helvetica Neue', -apple-system, sans-serif;
      background: #050505;
      color: #e8f5e8;
      min-height: 100vh;
      overflow: hidden;
    }
    
    .app { display: flex; height: 100vh; }
    
    .sidebar {
      width: 340px;
      background: #0a0f0a;
      border-right: 1px solid #1a2f1a;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    
    .logo { font-size: 1.2rem; font-weight: 300; margin-bottom: 25px; color: #22c55e; }
    .logo span { opacity: 0.5; }
    
    .section { margin-bottom: 20px; }
    .section-title { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #555; margin-bottom: 10px; }
    
    .shape-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
    .shape-btn {
      aspect-ratio: 1;
      background: #111;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-size: 11px;
      color: #666;
    }
    .shape-btn:hover { background: #1a1a1a; color: #888; }
    .shape-btn.active { border-color: #22c55e; background: #0f1f0f; color: #22c55e; }
    
    .palette-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
    .palette-btn {
      height: 40px;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      overflow: hidden;
    }
    .palette-btn:hover { border-color: #333; }
    .palette-btn.active { border-color: #22c55e; }
    .palette-btn div { flex: 1; }
    
    .color-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
    .color-input {
      flex: 1;
      height: 32px;
      border: 1px solid #222;
      border-radius: 4px;
      cursor: pointer;
      background: #111;
      padding: 2px;
    }
    .color-input::-webkit-color-swatch-wrapper { padding: 0; }
    .color-input::-webkit-color-swatch { border-radius: 3px; border: none; }
    .color-remove {
      width: 24px;
      height: 24px;
      background: #222;
      border: none;
      border-radius: 4px;
      color: #666;
      cursor: pointer;
      font-size: 14px;
    }
    .color-remove:hover { background: #333; color: #fff; }
    .add-color-btn {
      width: 100%;
      padding: 8px;
      background: #111;
      border: 1px dashed #333;
      border-radius: 6px;
      color: #555;
      cursor: pointer;
      font-size: 12px;
      margin-top: 8px;
    }
    .add-color-btn:hover { border-color: #22c55e; color: #22c55e; }
    
    .slider-row { margin-bottom: 12px; }
    .slider-header { display: flex; justify-content: space-between; margin-bottom: 4px; }
    .slider-label { font-size: 11px; color: #666; }
    .slider-value { font-size: 11px; color: #22c55e; }
    
    input[type="range"] {
      width: 100%;
      height: 4px;
      -webkit-appearance: none;
      background: #222;
      border-radius: 2px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #22c55e;
      border-radius: 50%;
      cursor: pointer;
    }
    
    .btn {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 6px;
    }
    .btn-primary { background: #22c55e; color: #000; font-weight: 500; }
    .btn-primary:hover { background: #4ade80; }
    .btn-secondary { background: #1a1a1a; color: #888; border: 1px solid #333; }
    .btn-secondary:hover { background: #222; color: #fff; }
    .btn-random { background: linear-gradient(135deg, #22c55e, #0891b2); color: #000; font-weight: 500; }
    
    .landing-shapes {
      background: #111;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 15px;
    }
    .landing-shapes-title { font-size: 10px; color: #555; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
    .landing-shape-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .landing-shape-btn {
      padding: 6px 10px;
      background: #1a1a1a;
      border: 1px solid #222;
      border-radius: 4px;
      color: #888;
      font-size: 11px;
      cursor: pointer;
    }
    .landing-shape-btn:hover { border-color: #22c55e; color: #22c55e; }
    
    .presets-list { flex: 1; overflow-y: auto; margin-top: 10px; }
    .preset-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      background: #111;
      border-radius: 6px;
      margin-bottom: 4px;
      cursor: pointer;
    }
    .preset-item:hover { background: #1a1a1a; }
    .preset-name { font-size: 12px; color: #ccc; }
    .preset-actions { display: flex; gap: 4px; }
    .preset-action {
      width: 22px;
      height: 22px;
      border: none;
      background: #222;
      border-radius: 4px;
      color: #666;
      cursor: pointer;
      font-size: 11px;
    }
    .preset-action:hover { background: #333; color: #fff; }
    .preset-action.delete:hover { background: #7f1d1d; color: #fca5a5; }
    
    .preview { flex: 1; position: relative; }
    #canvas-container { width: 100%; height: 100%; }
    canvas { display: block; }
    
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: #0a0f0a;
      border: 1px solid #1a2f1a;
      border-radius: 12px;
      padding: 24px;
      width: 400px;
      max-width: 90%;
    }
    .modal-title { font-size: 18px; margin-bottom: 16px; color: #22c55e; }
    .modal-input {
      width: 100%;
      padding: 12px;
      background: #111;
      border: 1px solid #222;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
      margin-bottom: 16px;
    }
    .modal-input:focus { outline: none; border-color: #22c55e; }
    .modal-buttons { display: flex; gap: 10px; }
    .modal-buttons .btn { flex: 1; margin: 0; }
    
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #22c55e;
      color: #000;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: transform 0.3s;
      z-index: 200;
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
    
    .config-output {
      background: #111;
      border: 1px solid #222;
      border-radius: 6px;
      padding: 10px;
      font-family: monospace;
      font-size: 11px;
      color: #888;
      margin-top: 10px;
      max-height: 150px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="sidebar">
      <div class="logo">otherwind <span>/ shapes</span></div>
      
      <div class="landing-shapes">
        <div class="landing-shapes-title">Load from Landing Page</div>
        <div class="landing-shape-list" id="landing-shapes"></div>
      </div>
      
      <div class="section">
        <div class="section-title">Geometry</div>
        <div class="shape-grid" id="shape-grid"></div>
      </div>
      
      <div class="section">
        <div class="section-title">Preset Palettes</div>
        <div class="palette-grid" id="palette-grid"></div>
      </div>
      
      <div class="section">
        <div class="section-title">Custom Colors</div>
        <div id="color-list"></div>
        <button class="add-color-btn" onclick="addColor()">+ Add Color</button>
      </div>
      
      <div class="section">
        <div class="section-title">Texture Settings</div>
        <div class="slider-row">
          <div class="slider-header">
            <span class="slider-label">Cell Count</span>
            <span class="slider-value" id="cells-value">15</span>
          </div>
          <input type="range" id="cell-count" min="5" max="40" value="15">
        </div>
        <div class="slider-row">
          <div class="slider-header">
            <span class="slider-label">Size</span>
            <span class="slider-value" id="size-value">1.8</span>
          </div>
          <input type="range" id="size-slider" min="0.5" max="3" step="0.1" value="1.8">
        </div>
        <div class="slider-row">
          <div class="slider-header">
            <span class="slider-label">Opacity</span>
            <span class="slider-value" id="opacity-value">85%</span>
          </div>
          <input type="range" id="opacity-slider" min="30" max="100" value="85">
        </div>
        <div class="slider-row">
          <div class="slider-header">
            <span class="slider-label">Rotation Speed</span>
            <span class="slider-value" id="rotation-value">0.008</span>
          </div>
          <input type="range" id="rotation-speed" min="0" max="30" value="8">
        </div>
      </div>
      
      <div class="section">
        <button class="btn btn-random" onclick="randomize()">ðŸŽ² Randomize</button>
        <button class="btn btn-primary" onclick="openSaveModal()">ðŸ’¾ Save Preset</button>
        <button class="btn btn-secondary" onclick="copyConfig()">ðŸ“‹ Copy Config for Landing Page</button>
      </div>
      
      <div class="section" style="flex: 1; display: flex; flex-direction: column; min-height: 150px;">
        <div class="section-title">Saved Presets</div>
        <div class="presets-list" id="presets-list"></div>
      </div>
    </div>
    
    <div class="preview">
      <div id="canvas-container"></div>
    </div>
  </div>
  
  <div class="modal-overlay" id="save-modal">
    <div class="modal">
      <div class="modal-title">Save Preset</div>
      <input type="text" class="modal-input" id="preset-name" placeholder="Enter preset name...">
      <div class="modal-buttons">
        <button class="btn btn-secondary" onclick="closeSaveModal()">Cancel</button>
        <button class="btn btn-primary" onclick="savePreset()">Save</button>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Geometries matching landing page
    const GEOMETRIES = [
      { id: 'icosahedron', name: 'Icosa', detail: 1 },
      { id: 'dodecahedron', name: 'Dodeca', detail: 0 },
      { id: 'octahedron', name: 'Octa', detail: 0 },
      { id: 'tetrahedron', name: 'Tetra', detail: 0 },
    ];
    
    // Palettes from landing page
    const PALETTES = [
      ['#4fd1a5', '#2d8b6f', '#1a5c4a', '#3d9b7f', '#5ae0b4'],
      ['#c9a962', '#8b6b4a', '#6b8b4a', '#a68b52', '#4a6b3a'],
      ['#6b9b8a', '#4a7b6a', '#3a6b5a', '#5a8b7a', '#2a5b4a'],
      ['#8bc9a9', '#6ba989', '#5a9979', '#7ab999', '#4a8969'],
      ['#a5c97b', '#85a95b', '#75994b', '#95b96b', '#65893b'],
      ['#7b9bc9', '#5b7ba9', '#4b6b99', '#6b8bb9', '#3b5b89'],
    ];
    
    // Landing page shapes
    const LANDING_SHAPES = [
      { name: 'Services', geo: 'icosahedron', size: 2.2, palette: 0 },
      { name: 'Contact', geo: 'dodecahedron', size: 1.8, palette: 1 },
      { name: 'Work', geo: 'octahedron', size: 1.5, palette: 2 },
      { name: 'Team', geo: 'icosahedron', size: 1.3, palette: 3 },
      { name: 'Insights', geo: 'tetrahedron', size: 1.6, palette: 4 },
      { name: 'About', geo: 'dodecahedron', size: 1.1, palette: 5 },
      { name: 'News', geo: 'octahedron', size: 0.9, palette: 0 },
    ];
    
    // State
    let state = {
      geometry: 'icosahedron',
      palette: 0,
      customColors: ['#4fd1a5', '#2d8b6f', '#1a5c4a', '#3d9b7f', '#5ae0b4'],
      cellCount: 15,
      size: 1.8,
      opacity: 85,
      rotationSpeed: 8,
      useCustomColors: false,
    };
    
    // Three.js
    let scene, camera, renderer, currentMesh;
    let mouseX = 0, mouseY = 0;
    
    function initThree() {
      const container = document.getElementById('canvas-container');
      
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 0, 6);
      
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setClearColor(0x050505, 1);
      container.appendChild(renderer.domElement);
      
      // Add some ambient particles like landing page
      addParticles();
      
      document.addEventListener('mousemove', (e) => {
        mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
        mouseY = (e.clientY / window.innerHeight - 0.5) * 2;
      });
      
      window.addEventListener('resize', () => {
        camera.aspect = container.clientWidth / container.clientHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(container.clientWidth, container.clientHeight);
      });
      
      updateShape();
      animate();
    }
    
    function addParticles() {
      const particleCount = 200;
      const particleGeo = new THREE.BufferGeometry();
      const positions = new Float32Array(particleCount * 3);
      
      for (let i = 0; i < particleCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 30;
        positions[i * 3 + 1] = (Math.random() - 0.5) * 20;
        positions[i * 3 + 2] = (Math.random() - 0.5) * 20 - 5;
      }
      
      particleGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const particleMat = new THREE.PointsMaterial({
        color: 0x22c55e,
        size: 0.02,
        transparent: true,
        opacity: 0.4,
      });
      
      const particles = new THREE.Points(particleGeo, particleMat);
      scene.add(particles);
    }
    
    // Cell texture - EXACTLY like landing page
    function createCellTexture(colorPalette, cellCount = 15) {
      const canvas = document.createElement('canvas');
      canvas.width = 512;
      canvas.height = 512;
      const ctx = canvas.getContext('2d');
      
      ctx.fillStyle = '#0a1a12';
      ctx.fillRect(0, 0, 512, 512);
      
      const cells = [];
      for (let i = 0; i < cellCount; i++) {
        cells.push({
          x: Math.random() * 512,
          y: Math.random() * 512,
          color: colorPalette[Math.floor(Math.random() * colorPalette.length)]
        });
      }
      
      for (let x = 0; x < 512; x += 3) {
        for (let y = 0; y < 512; y += 3) {
          let minDist = Infinity;
          let closestCell = cells[0];
          
          cells.forEach(cell => {
            const dist = Math.sqrt((x - cell.x) ** 2 + (y - cell.y) ** 2);
            if (dist < minDist) {
              minDist = dist;
              closestCell = cell;
            }
          });
          
          ctx.fillStyle = closestCell.color;
          ctx.globalAlpha = 0.6 + Math.random() * 0.4;
          ctx.fillRect(x, y, 3, 3);
        }
      }
      
      ctx.globalAlpha = 0.3;
      ctx.strokeStyle = '#0a1a12';
      ctx.lineWidth = 2;
      cells.forEach(cell => {
        ctx.beginPath();
        ctx.arc(cell.x, cell.y, 3, 0, Math.PI * 2);
        ctx.stroke();
      });
      
      const texture = new THREE.CanvasTexture(canvas);
      texture.needsUpdate = true;
      return texture;
    }
    
    function createGeometry(geoId, size) {
      const geo = GEOMETRIES.find(g => g.id === geoId) || GEOMETRIES[0];
      switch(geoId) {
        case 'icosahedron': return new THREE.IcosahedronGeometry(size, geo.detail);
        case 'dodecahedron': return new THREE.DodecahedronGeometry(size, geo.detail);
        case 'octahedron': return new THREE.OctahedronGeometry(size, geo.detail);
        case 'tetrahedron': return new THREE.TetrahedronGeometry(size, geo.detail);
        default: return new THREE.IcosahedronGeometry(size, 1);
      }
    }
    
    function updateShape() {
      if (currentMesh) {
        scene.remove(currentMesh);
        currentMesh.geometry.dispose();
        currentMesh.material.dispose();
      }
      
      const colors = state.useCustomColors ? state.customColors : PALETTES[state.palette];
      const geometry = createGeometry(state.geometry, state.size);
      const texture = createCellTexture(colors, state.cellCount);
      
      const material = new THREE.MeshBasicMaterial({
        map: texture,
        transparent: true,
        opacity: state.opacity / 100,
      });
      
      currentMesh = new THREE.Mesh(geometry, material);
      scene.add(currentMesh);
    }
    
    function animate() {
      requestAnimationFrame(animate);
      
      if (currentMesh) {
        currentMesh.rotation.y += state.rotationSpeed / 1000;
        currentMesh.rotation.x += mouseY * 0.01;
        currentMesh.rotation.z += mouseX * 0.005;
      }
      
      camera.position.x = mouseX * 0.5;
      camera.position.y = -mouseY * 0.3;
      camera.lookAt(0, 0, 0);
      
      renderer.render(scene, camera);
    }
    
    // UI Setup
    function setupUI() {
      // Landing page shapes
      const landingList = document.getElementById('landing-shapes');
      LANDING_SHAPES.forEach(shape => {
        const btn = document.createElement('button');
        btn.className = 'landing-shape-btn';
        btn.textContent = shape.name;
        btn.onclick = () => loadLandingShape(shape);
        landingList.appendChild(btn);
      });
      
      // Geometry grid
      const shapeGrid = document.getElementById('shape-grid');
      GEOMETRIES.forEach(geo => {
        const btn = document.createElement('button');
        btn.className = `shape-btn ${state.geometry === geo.id ? 'active' : ''}`;
        btn.textContent = geo.name;
        btn.onclick = () => selectGeometry(geo.id);
        shapeGrid.appendChild(btn);
      });
      
      // Palette grid
      const paletteGrid = document.getElementById('palette-grid');
      PALETTES.forEach((palette, i) => {
        const btn = document.createElement('button');
        btn.className = `palette-btn ${state.palette === i ? 'active' : ''}`;
        palette.slice(0, 5).forEach(color => {
          const div = document.createElement('div');
          div.style.background = color;
          btn.appendChild(div);
        });
        btn.onclick = () => selectPalette(i);
        paletteGrid.appendChild(btn);
      });
      
      // Color list
      renderColorList();
      
      // Sliders
      document.getElementById('cell-count').addEventListener('input', (e) => {
        state.cellCount = parseInt(e.target.value);
        document.getElementById('cells-value').textContent = state.cellCount;
        updateShape();
      });
      
      document.getElementById('size-slider').addEventListener('input', (e) => {
        state.size = parseFloat(e.target.value);
        document.getElementById('size-value').textContent = state.size.toFixed(1);
        updateShape();
      });
      
      document.getElementById('opacity-slider').addEventListener('input', (e) => {
        state.opacity = parseInt(e.target.value);
        document.getElementById('opacity-value').textContent = state.opacity + '%';
        updateShape();
      });
      
      document.getElementById('rotation-speed').addEventListener('input', (e) => {
        state.rotationSpeed = parseInt(e.target.value);
        document.getElementById('rotation-value').textContent = (state.rotationSpeed / 1000).toFixed(3);
      });
      
      loadPresets();
    }
    
    function renderColorList() {
      const list = document.getElementById('color-list');
      list.innerHTML = '';
      state.customColors.forEach((color, i) => {
        const row = document.createElement('div');
        row.className = 'color-row';
        row.innerHTML = `
          <input type="color" class="color-input" value="${color}" onchange="updateColor(${i}, this.value)">
          <button class="color-remove" onclick="removeColor(${i})">Ã—</button>
        `;
        list.appendChild(row);
      });
    }
    
    function addColor() {
      const hue = Math.random() * 360;
      state.customColors.push(hslToHex(hue, 60, 50));
      state.useCustomColors = true;
      renderColorList();
      updateShape();
    }
    
    function removeColor(index) {
      if (state.customColors.length > 2) {
        state.customColors.splice(index, 1);
        state.useCustomColors = true;
        renderColorList();
        updateShape();
      }
    }
    
    function updateColor(index, value) {
      state.customColors[index] = value;
      state.useCustomColors = true;
      updateShape();
    }
    
    function selectGeometry(id) {
      state.geometry = id;
      document.querySelectorAll('.shape-btn').forEach((btn, i) => {
        btn.classList.toggle('active', GEOMETRIES[i].id === id);
      });
      updateShape();
    }
    
    function selectPalette(index) {
      state.palette = index;
      state.useCustomColors = false;
      state.customColors = [...PALETTES[index]];
      document.querySelectorAll('.palette-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === index);
      });
      renderColorList();
      updateShape();
    }
    
    function loadLandingShape(shape) {
      state.geometry = shape.geo;
      state.size = shape.size;
      state.palette = shape.palette;
      state.useCustomColors = false;
      state.customColors = [...PALETTES[shape.palette]];
      
      document.querySelectorAll('.shape-btn').forEach((btn, i) => {
        btn.classList.toggle('active', GEOMETRIES[i].id === shape.geo);
      });
      document.querySelectorAll('.palette-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === shape.palette);
      });
      document.getElementById('size-slider').value = shape.size;
      document.getElementById('size-value').textContent = shape.size.toFixed(1);
      
      renderColorList();
      updateShape();
      showToast(`Loaded: ${shape.name}`);
    }
    
    function randomize() {
      state.geometry = GEOMETRIES[Math.floor(Math.random() * GEOMETRIES.length)].id;
      state.palette = Math.floor(Math.random() * PALETTES.length);
      state.useCustomColors = false;
      state.customColors = [...PALETTES[state.palette]];
      state.cellCount = 8 + Math.floor(Math.random() * 25);
      state.size = 1 + Math.random() * 1.5;
      state.opacity = 70 + Math.floor(Math.random() * 30);
      state.rotationSpeed = 3 + Math.floor(Math.random() * 15);
      
      document.querySelectorAll('.shape-btn').forEach((btn, i) => {
        btn.classList.toggle('active', GEOMETRIES[i].id === state.geometry);
      });
      document.querySelectorAll('.palette-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === state.palette);
      });
      
      document.getElementById('cell-count').value = state.cellCount;
      document.getElementById('cells-value').textContent = state.cellCount;
      document.getElementById('size-slider').value = state.size;
      document.getElementById('size-value').textContent = state.size.toFixed(1);
      document.getElementById('opacity-slider').value = state.opacity;
      document.getElementById('opacity-value').textContent = state.opacity + '%';
      document.getElementById('rotation-speed').value = state.rotationSpeed;
      document.getElementById('rotation-value').textContent = (state.rotationSpeed / 1000).toFixed(3);
      
      renderColorList();
      updateShape();
      showToast('Randomized! ðŸŽ²');
    }
    
    function copyConfig() {
      const config = {
        geo: state.geometry,
        size: state.size,
        palette: state.useCustomColors ? state.customColors : state.palette,
        cellCount: state.cellCount,
        opacity: state.opacity / 100,
        rotSpeed: state.rotationSpeed / 1000,
      };
      
      const configStr = JSON.stringify(config, null, 2);
      navigator.clipboard.writeText(configStr);
      showToast('Config copied! Paste into shapeConfigs in index.html ðŸ“‹');
    }
    
    function hslToHex(h, s, l) {
      s /= 100; l /= 100;
      const a = s * Math.min(l, 1 - l);
      const f = n => {
        const k = (n + h / 30) % 12;
        const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
        return Math.round(255 * color).toString(16).padStart(2, '0');
      };
      return `#${f(0)}${f(8)}${f(4)}`;
    }
    
    // Presets
    function openSaveModal() {
      document.getElementById('save-modal').classList.add('active');
      document.getElementById('preset-name').focus();
    }
    
    function closeSaveModal() {
      document.getElementById('save-modal').classList.remove('active');
      document.getElementById('preset-name').value = '';
    }
    
    function savePreset() {
      const name = document.getElementById('preset-name').value.trim();
      if (!name) { showToast('Enter a name'); return; }
      
      const presets = JSON.parse(localStorage.getItem('otherwind-shape-presets') || '[]');
      presets.push({ id: Date.now(), name, config: { ...state } });
      localStorage.setItem('otherwind-shape-presets', JSON.stringify(presets));
      
      closeSaveModal();
      loadPresets();
      showToast('Saved! ðŸ’¾');
    }
    
    function loadPresets() {
      const presets = JSON.parse(localStorage.getItem('otherwind-shape-presets') || '[]');
      const list = document.getElementById('presets-list');
      list.innerHTML = presets.length === 0 
        ? '<div style="color: #333; font-size: 11px; text-align: center; padding: 20px;">No presets yet</div>'
        : '';
      
      presets.forEach(preset => {
        const item = document.createElement('div');
        item.className = 'preset-item';
        item.innerHTML = `
          <span class="preset-name">${preset.name}</span>
          <div class="preset-actions">
            <button class="preset-action" onclick="event.stopPropagation(); loadPreset(${preset.id})">â†©</button>
            <button class="preset-action delete" onclick="event.stopPropagation(); deletePreset(${preset.id})">Ã—</button>
          </div>
        `;
        item.onclick = () => loadPreset(preset.id);
        list.appendChild(item);
      });
    }
    
    function loadPreset(id) {
      const presets = JSON.parse(localStorage.getItem('otherwind-shape-presets') || '[]');
      const preset = presets.find(p => p.id === id);
      if (!preset) return;
      
      state = { ...preset.config };
      
      document.querySelectorAll('.shape-btn').forEach((btn, i) => {
        btn.classList.toggle('active', GEOMETRIES[i].id === state.geometry);
      });
      document.querySelectorAll('.palette-btn').forEach((btn, i) => {
        btn.classList.toggle('active', i === state.palette);
      });
      
      document.getElementById('cell-count').value = state.cellCount;
      document.getElementById('cells-value').textContent = state.cellCount;
      document.getElementById('size-slider').value = state.size;
      document.getElementById('size-value').textContent = state.size.toFixed(1);
      document.getElementById('opacity-slider').value = state.opacity;
      document.getElementById('opacity-value').textContent = state.opacity + '%';
      document.getElementById('rotation-speed').value = state.rotationSpeed;
      document.getElementById('rotation-value').textContent = (state.rotationSpeed / 1000).toFixed(3);
      
      renderColorList();
      updateShape();
      showToast(`Loaded: ${preset.name}`);
    }
    
    function deletePreset(id) {
      const presets = JSON.parse(localStorage.getItem('otherwind-shape-presets') || '[]');
      localStorage.setItem('otherwind-shape-presets', JSON.stringify(presets.filter(p => p.id !== id)));
      loadPresets();
      showToast('Deleted');
    }
    
    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }
    
    document.addEventListener('DOMContentLoaded', () => { setupUI(); initThree(); });
    document.getElementById('preset-name').addEventListener('keypress', (e) => { if (e.key === 'Enter') savePreset(); });
  </script>
</body>
</html>
